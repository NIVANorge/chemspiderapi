---
title: "chemspiderapi"
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

> `R` functionalities for ChemSpider's new API services

ChemSpider has introduced a new API syntax in late 2018, and [the old ChemSpider API syntax will be shut down at the end of November 2018](http://link.rsc.org/rsps/m/xSq8Cm8ovjN8-Elm0eYB3Sey61zutqNIUUaMcyc14sQ). `chemspiderapi` provides `R` wrappers around the new API services from ChemSpider. 

The aim of this package is to:

1) Translate the new ChemSpider API services into `R`-friendly functions.
2) Include thorough quality checking *before* the query is send, to avoid using up the query quota on, e.g., spelling errors.
3) Implement the `R` functionality in a way that is suitable for both `base` and `tidyverse` programming.
4) Provide (non-ChemSpider) convenience functions to complement the functionality.

The `chemspiderapi` package is platform independent, but requires a valid ChemSpider API key. While the `chemspiderapi` package does *not* provide any tools to securely store and access the API key, a look into the excellent [`keyring`](https://github.com/r-lib/keyring) package is recommended. To "remember" the results of API queries (i.e., to not ruin the API allowance),  [`memoise`](https://github.com/r-lib/memoise) is recommended. Finally, any rate limitations can be created with functionalities from [`ratelimitr`](https://github.com/tarakc02/ratelimitr).

## Coverage

As of `r Sys.Date()`, the following functionalities are implemented (`r signif((25 / 25) * 100, digits = 2)`% functionality with `r signif((5 / 27) * 100, digits = 2)`% annotation):

**FILTERING**

| ChemSpider Compound API                  | `chemspiderapi` Wrapper                              | `chemspiderapi` Help File |
|:---------------------------------------- |:---------------------------------------------------- |:-------------------------:|
| filter-element-post                      | `chemspiderapi::post_element()`                      |                           |
| filter-formula-batch-post                | `chemspiderapi::post_formula_batch()`                |                           |
| filter-formula-batch-queryId-results-get | `chemspiderapi::get_formula_batch_queryId_results()` |                           |
| filter-formula-batch-queryId-status-get  | `chemspiderapi::get_formula_batch_queryId_status()`  |                           |
| filter-formula-post                      | `chemspiderapi::post_formula()`                      |                           |
| filter-inchi-post                        | `chemspiderapi::post_inchi()`                        |                           |
| filter-inchikey-post                     | `chemspiderapi::post_inchikey()`                     | yes                       |
| filter-intrinsicproperty-post            | `chemspiderapi::post_intrinsicproperty()`            |                           |
| filter-mass-batch-post                   | `chemspiderapi::post_mass_batch()`                   |                           |
| filter-mass-batch-queryId-results-get    | `chemspiderapi::get_mass_batch_queryId_results()`    |                           |
| filter-mass-batch-queryId-status-get     | `chemspiderapi::get_mass_batch_queryId_status()`     |                           |
| filter-mass-post                         | `chemspiderapi::post_mass()`                         |                           |
| filter-name-post                         | `chemspiderapi::post_name()`                         |                           |
| filter-queryId-results-get               | `chemspiderapi::get_queryId_results()`               | yes                       |
| filter-queryId-results-sdf-get           | `chemspiderapi::get_queryId_results_sdf()` *         |                           |
| filter-queryId-status-get                | `chemspiderapi::get_queryId_status()`                | yes                       |
| filter-smiles-post                       | `chemspiderapi::post_smiles()`                       |                           |

\* `chemspiderapi::get_queryId_results_sdf()` downloads the gzipped base64-encoded character string, but there is currently no implementation for accessing the (multiple) .mol files contained inside.

**LOOKUPS**

| ChemSpider Compound API | `chemspiderapi` Wrapper            | `chemspiderapi` Help File |
|:----------------------- |:---------------------------------- |:-------------------------:|
| lookups-datasources-get | `chemspiderapi::get_datasources()` | yes                       |

**RECORDS**

| ChemSpider Compound API                 | `chemspiderapi` Wrapper                            | `chemspiderapi` Help File |
|:--------------------------------------- |:-------------------------------------------------- |:-------------------------:|
| records-batch-post                      | `chemspiderapi::post_batch()`                      |                           |
| records-recordId-details-get            | `chemspiderapi::get_recordId_details()`            | yes                       |
| records-recordId-externalreferences-get | `chemspiderapi::get_recordId_externalreferences()` |                           |
| records-recordId-image-get              | `chemspiderapi::get_recordId_image()`              |                           |
| records-recordId-mol-get                | `chemspiderapi::get_recordId_mol()`                |                           |

**TOOLS**

| ChemSpider Compound API      | `chemspiderapi` Wrapper                   | `chemspiderapi` Help File |
|:---------------------------- |:----------------------------------------- |:-------------------------:|
| tools-convert-post           | `chemspiderapi::post_convert()`           |                           |
| tools-validate-inchikey-post | `chemspiderapi::post_validate_inchikey()` |                           |

**WRITING (`chemspiderapi` EXCLUSIVE)**

| ChemSpider Compound API | `chemspiderapi` Wrapper        | `chemspiderapi` Help File |
|:----------------------- |:------------------------------ |:-------------------------:|
|                         | `chemspiderapi::write_image()` |                           |
|                         | `chemspiderapi::write_mol()`   |                           |

## Installation

### Dependencies

This packages relies on two essential dependencies, namely `curl` and `jsonlite`. Additional (but not crucial) functionality for handling images is coming from the `png` package.

If not already installed, these packages *should* be installed automatically when installing `chemspiderapi`. Should this result in trouble, the dependency packages can be installed manually:

```{r, eval=FALSE}
install.packages(c("curl", "jsonlite", "png"))
```

If `curl` and/or `jsonlite` are missing from the R library, all functions of `chemspiderapi` will throw an error.

### R package

Install the package from GitHub (using `devtools`):

```{r,eval=FALSE}
# install.packages("devtools")
devtools::install_github("NIVANorge/chemspiderapi")
```

Currently the only tested environment for `chemspiderapi` is Windows 10, but it *should* install smoothly on macOS and Linux distributions as well. Please open an issue if you run into any troubles. 

## Best practices for ChemSpider's Compound APIs

This section will be updated with practical examples in the future.

The basic workflow order for the above **FILTERING** queries is: 

1) POST Query

2) GET Status

3) GET Results (after GET Status returns `"Complete"`)

In practice, this means the following possivle workflows can be implemented:

| POST Query                                | GET Status                                          | GET Result                                           |
:------------------------------------------ |:--------------------------------------------------- |:---------------------------------------------------- |
| `chemspiderapi::post_element()`           | `chemspiderapi::get_queryId_status()`               | `chemspiderapi::get_queryId_results()`               |
| `chemspiderapi::post_formula()`           | `chemspiderapi::get_queryId_status()`               | `chemspiderapi::get_queryId_results()`               |
| `chemspiderapi::post_formula_batch()`     | `chemspiderapi::get_formula_batch_queryId_status()` | `chemspiderapi::get_formula_batch_queryId_results()` |
| `chemspiderapi::post_inchi()`             | `chemspiderapi::get_queryId_status()`               | `chemspiderapi::get_queryId_results()`               |
| `chemspiderapi::post_inchikey()`          | `chemspiderapi::get_queryId_status()`               | `chemspiderapi::get_queryId_results()`               |
| `chemspiderapi::post_intrinsicproperty()` | `chemspiderapi::get_queryId_status()`               | `chemspiderapi::get_queryId_results()`               |
| `chemspiderapi::post_mass()`              | `chemspiderapi::get_queryId_status()`               | `chemspiderapi::get_queryId_results()`               |
| `chemspiderapi::post_mass_batch()`        | `chemspiderapi::get_mass_batch_queryId_status()`    | `chemspiderapi::get_mass_batch_queryId_results()`    |
| `chemspiderapi::post_mass()`              | `chemspiderapi::get_queryId_status()`               | `chemspiderapi::get_queryId_results()`               |
| `chemspiderapi::post_name()`              | `chemspiderapi::get_queryId_status()`               | `chemspiderapi::get_queryId_results()`               |
| `chemspiderapi::post_smiles()`            | `chemspiderapi::get_queryId_status()`               | `chemspiderapi::get_queryId_results()`               |

Typically, the result will be one or multiple ChemSpider IDs (`recordId`). They can be used as  input into the above **RECORDS** queries.

## Funding

This package was created at the [Norwegian Institute for Water Research (NIVA)](https://www.niva.no/en) in conjunction with NIVA's Computational Toxicology Program (NCTP) at NIVA's [Section for Ecotoxicology and Risk Assessment](https://www.niva.no/en/research/environmental-toxicology) and funded by [The Research Council of Norway (RCN)](https://www.forskningsradet.no/en/Home_page/1177315753906), project 268294: [Cumulative Hazard and Risk Assessment of Complex Mixtures and Multiple Stressors (MixRisk)](https://www.forskningsradet.no/prosjektbanken/#/project/NFR/268294/Sprak=en).

## License

MIT Â© Raoul Wolf
